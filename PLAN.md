# Haskell開発環境 構築プラン

このドキュメントは、GitHub Codespaces上でHaskellを用いた競技プログラミング環境を構築するための作業計画を記述します。

## 0. 開発方針

- **コンテナのリビルドとセッション:**
  作業の進捗、決定事項、参照情報など、必要なすべての情報は常にこの`PLAN.md`に記録します。
- **作業の進め方:**
  - **細やかなコミット:** 動作確認ができた単位で積極的にコミットを作成します。
  - **アプローチの記録:** 複数の解決策が考えられる場合は、長所・短所を記述し、選択理由の記録を残します。

- **参照情報:**
  - [Haskeller のための AtCoder 言語アップデート 2025](https://zenn.dev/toyboot4e/articles/haskell-on-atcoder-2025)
  - [AtCoder 2025 language update for Haskell (GHC 9.8.4) - インストールスクリプト](https://gist.github.com/toyboot4e/04b902271997b3c865cc91014720ec40)

## 1. 大目標

- GitHub Codespaces を利用して、AtCoderの2025年言語アップデート（GHC 9.8.4）に準拠したHaskell開発環境を構築し、`ac-library-hs`などのライブラリを利用可能にする。

## 2. 現状と課題

- **現在の環境:**
  - `Dockerfile`により、GHC `9.0.2` とStackがインストールされている。
  - `hs`ディレクトリ配下に`stack.yaml`はなく、各問題は独立した形で`runghc Main.hs`でテストされている。
- **課題:**
  - GHCのバージョンが古く、目標の`9.8.4`と異なっている。
  - `ac-library-hs`などの新しいライブラリがインストールされていない。

## 3. 作業計画

本プロジェクトは、個々の問題を独立して扱う現在のワークフローを維持することを重視します。そのため、`hs`ディレクトリを一つの大きなStackプロジェクトにするのではなく、**StackのGlobal Project機能**を活用して、システム全体で利用可能なライブラリ環境を整備するアプローチを取ります。

- [ ] **ステップ1: GHCバージョンの更新**
    - [ ] `.devcontainer/Dockerfile`を修正し、`ghcup`経由でインストールするGHCのバージョンを `9.0.2` から `9.8.4` に変更する。
    - [ ] Codespacesをリビルドし、コンテナ内で `ghc --version` を実行して、バージョンが `9.8.4` になっていることを確認する。

- [ ] **ステップ2: Stack Resolverの更新とライブラリの導入**
    - [ ] `Dockerfile`に、`stack`コマンドを使ってAtCoderの新しいジャッジ環境に合わせたライブラリをGlobal Projectにインストールする処理を追加する。
        - **Resolverの選定:** GHC 9.8.4に対応するStackage Resolver（`lts-23`系のnightlyまたは`ghc-9.8.4`）を指定する。
        - **ライブラリのインストール:** `stack install ac-library-hs-1.5.3.0 vector-0.13.2.0 ...` のように、`web_fetch`で調査した主要ライブラリをインストールするコマンドを`Dockerfile`に追記する。
    - [ ] Codespacesをリビルドし、インストールが正常に完了することを確認する。

- [ ] **ステップ3: 動作確認**
    - [ ] `hs`ディレクトリ配下にテスト用のディレクトリ（例: `hs/_trial/a`）を作成する。
    - [ ] `Main.hs`を作成し、`ac-library-hs`の`Data.FenwickTree`などを`import`する簡単なコードを記述する。
    - [ ] コンテナのターミナルで `stack exec runghc -- hs/_trial/a/Main.hs` を実行し、コードがエラーなく実行されることを確認する。

- [ ] **ステップ4: 既存ワークフローへの統合**
    - [ ] `SETUP_NOTE.md` に記載されているテストコマンド `oj test -c 'runghc Main.hs' ...` を、Stack経由で実行できるように修正する必要があるか検討する。
    - [ ] 必要であれば、`oj test -c 'stack exec runghc -- Main.hs'` のようにコマンドを更新し、`SETUP_NOTE.md`の記述もそれに合わせて変更する。

- [ ] **ステップ5: クリーンアップと最終確認**
    - [ ] 動作確認用に作成したテストディレクトリやファイルを削除または`.gitignore`に追加する。
    - [ ] 最終的な構成でCodespacesが正常に起動し、開発環境として利用できることを確認する。

## 重要な補足

本プロジェクトは既にStackベースで、Github Codespacesが動作しています。
セットアップ当時は適当に導入していましたので、AtCoderの実際の環境とは一致していませんが、2025の言語アップデートに合わせてちゃんと環境を整えたい形です。
あくまで競技プログラミングに取り組むために、利用できるライブラリやバージョンを揃えたいだけの意図であり、ジャッジサーバーを建てたいわけではありません。
公式スクリプトはcabalで構成されていますが正しく保守するのは難しいので、stackベースでライブラリバージョンを揃える形で進行してください。

## 構造

ルートのhs/配下がHaskell用の作業環境で、コンテスト名/問題/コードやテスト が置かれる構造になっています。
他の言語用のディレクトリもありますのが、そちらは特に確認する必要はありません。

プロジェクト全体がHaskell用のものではなく、個々の問題は独立して動作確認をする形になります。
利用方法のイメージについては、README.md を参照ください。
 ※ Main.hs と同じディレクトリで、testコマンドを打ったりGHCiで確認する程度です。